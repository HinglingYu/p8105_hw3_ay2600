---
title: "Data Science HW 3"
author: "Hingling Yu"
date: "2023-10-07"
output: github_document
geometry: margin = 0.85in
fontsize: 12pt
---

## Problem 0

```{r setup, include=FALSE}
library(tidyverse)
library(ggridges)
library(patchwork)

library(p8105.datasets)

knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 8, 
  fig.height = 6,
  out.width = "90%"
)

theme_set(theme_minimal() + theme(legend.position = "bottom"))

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```


## Problem 1

#### Read dataset

```{r}
data("instacart")

instacart = 
  instacart |> 
  as_tibble()
```

#### Answer the questions

- The `instacart` dataset contains `r nrow(instacart)` of rows, and each row representing a single product from an instacart order. Also contains `r ncol(instacart)`columns, which are variables include identifiers for user, order, and product; the order in which each product was added to the cart. There are several order-level variables, describing the day and time of the order, and number of days since prior order. Then there are several item-specific variables, describing the product name (e.g. Yogurt, Avocado), department (e.g. dairy and eggs, produce), and aisle (e.g. yogurt, fresh fruits), and whether the item has been ordered by this user in the past. 

- In total, there are `r instacart |> select(product_id) |> distinct() |> count()` products found in `r instacart |> select(user_id, order_id) |> distinct() |> count()` orders from `r instacart |> select(user_id) |> distinct() |> count()` distinct users.

```{r}
instacart |>
  count(aisle) |> # How many aisles
  arrange(desc(n)) # See what aisles are the most items order from so descending
```

- According to the table above, there are 134 aisles in total, and fresh vegetables and fresh fruits are the most items ordered from.


#### Make a plot that shows the number of items ordered in each aisle

```{r}
instacart|> 
  count(aisle) |> # count the number of items order in each aisles
  filter(n > 10000) |> # Want aisles with more than 10000 items ordered
  mutate(aisle = fct_reorder(aisle, n)) |> # order aisles by the number of items order
  ggplot(aes(x = aisle, y = n)) +
  geom_point() +
  labs(
    title = "Number of items ordered in each aisle", # Give a title to the plot
    y = "Number of items(n)") + # Give the y-axis a easier understand label
  theme(axis.text.x = element_text(angle = 60, hjust = 1)) # Twist the angle of text in the x-axis for easier reading
```


#### Make a table showing the three most popular items in each of the aisles “baking ingredients”, “dog food care”, and “packaged vegetables fruits”. Include the number of times each item is ordered in your table.




#### Table of three most popular items in selected aisles

```{r}
instacart |>
  filter(aisle %in% c("baking ingredients", "dog food care", "packaged vegetables fruits")) |>
  group_by(aisle) |>
  count(product_name) |>
  mutate(rank = min_rank(desc(n))) |># rank by descending so we can easily get the top 3 popular products in each of the aisle we want
  filter(rank < 4) |> # filter the top 3 popular items
  arrange(desc(n)) |> # arrange with the most number of items ordered first
  rename(number_of_times_ordered = n)|> # rename n to number_of_times_ordered
  select(-rank)|> #remove variable rank
  knitr::kable()
```







